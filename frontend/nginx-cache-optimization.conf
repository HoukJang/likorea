# Nginx 캐시 최적화 설정
server {
    # 정적 자산 장기 캐싱 (1년)
    location ~* \.(js|css|png|jpg|jpeg|gif|webp|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        add_header Vary Accept-Encoding;
        
        # Gzip 압축
        gzip on;
        gzip_vary on;
        gzip_types
            text/plain
            text/css
            text/xml
            text/javascript
            application/json
            application/javascript
            application/xml+rss
            application/atom+xml
            image/svg+xml;
        
        # Brotli 압축 (더 효율적)
        brotli on;
        brotli_types
            text/plain
            text/css
            application/json
            application/javascript
            text/xml
            application/xml
            application/xml+rss
            text/javascript;
    }
    
    # HTML 파일 (짧은 캐시)
    location ~* \.html$ {
        expires 5m;
        add_header Cache-Control "public, must-revalidate";
    }
    
    # API 응답 캐시 (조건부)
    location /api/ {
        # GET 요청만 캐시
        if ($request_method = GET) {
            expires 5m;
            add_header Cache-Control "public, must-revalidate";
        }
        
        # POST/PUT/DELETE는 캐시하지 않음
        if ($request_method != GET) {
            expires -1;
            add_header Cache-Control "no-cache, no-store, must-revalidate";
        }
    }
    
    # Service Worker 파일은 캐시하지 않음
    location /service-worker.js {
        expires -1;
        add_header Cache-Control "no-cache, no-store, must-revalidate";
    }
}